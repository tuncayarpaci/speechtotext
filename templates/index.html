<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Whisper Pro API Test</title>
    <style>
        body { font-family: 'Inter', sans-serif; background: #f8f9fa; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .card { background: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 10px 25px rgba(0,0,0,0.05); width: 100%; max-width: 500px; }
        #live-box { background: #1e293b; color: #38bdf8; padding: 1.5rem; border-radius: 0.5rem; margin: 1rem 0; font-weight: 600; min-height: 80px; }
        .btn { width: 100%; padding: 1rem; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: bold; font-size: 1rem; }
        .start { background: #10b981; color: white; }
        .stop { background: #ef4444; color: white; display: none; }
    </style>
</head>
<body>
    <div class="card">
        <h2>Whisper Real-Time API</h2>
        <div id="status" style="font-size: 0.8rem; color: #64748b;">API Key: tuncay_ozel_key_123</div>
        <div id="live-box">Sizi dinlemek için hazır...</div>
        <button id="btn" class="btn start">Kayda Başla</button>
    </div>

    <script>
        let socket;
        let mediaRecorder;
        const btn = document.getElementById('btn');
        const box = document.getElementById('live-box');
        const apiKey = "tuncay_ozel_key_123";

        btn.onclick = async () => {
            if (btn.classList.contains('start')) {
                socket = new WebSocket(`ws://${window.location.host}/ws/${apiKey}`);
                
                socket.onmessage = (e) => {
                    const data = JSON.parse(e.data);
                    box.innerText = data.text;
                };

                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm;codecs=opus' });
                mediaRecorder.ondataavailable = (e) => {
                    if (e.data.size > 0 && socket.readyState === WebSocket.OPEN) {
                        socket.send(e.data);
                    }
                };
                mediaRecorder.start(1500);
                
                btn.innerText = "Durdur";
                btn.className = "btn stop";
                btn.style.display = "block";
            } else {
                mediaRecorder.stop();
                socket.close();
                btn.innerText = "Kayda Başla";
                btn.className = "btn start";
            }
        };
    </script>
</body>
</html>